<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Talk to an AI Celebrity</title>
  <link rel="stylesheet" href="/static/tailwind-compiled-styles.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Montserrat:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@200;400;500;600;700;800&display=swap"
    rel="stylesheet">
</head>
<style>
  #end-conversation-button {
    display: none;
  }
</style>

<body class="bg-zinc-900 text-white py-6 px-4">
  <h1 class="mt-8 text-6xl font-bold text-center mb-10 font-mono uppercase">Talk to an AI celebrity</h1>
  <img src="/static/images/0.jpeg" alt="" class="mt-24 mx-auto h-72 rounded-full" id="header-img">
  <div class="mt-24 flex flex-col w-[50vw] mx-auto">
    <label for="" class="text-2xl font-semibold mb-4">Choose a person to talk to:</label>
    <select name="" id="voice-id" class="text-black p-4 font-medium text-xl border-2 mb-8">
      {% for voice in voices %}
      <option value="{{ voice['internal-id'] }}">{{voice["person-name"]}}</option>
      {% endfor %}
    </select>
    <p class="mb-12 text-center text-xl font-semibold" id="status-label"></p>
    <button class="uppercase  font-bold text-lg p-4 bg-green-600 text-white rounded-lg" id="start-conversation-button">Start conversation</button>
    <button class="uppercase font-bold text-lg p-4 bg-red-600 text-white rounded-lg" id="end-conversation-button">End conversation</button>
    
  </div>
</body>
<script>
  let isConversing = false;
  let startButton = document.getElementById("start-conversation-button");
  let endButton = document.getElementById("end-conversation-button");
  let statusLabel = document.querySelector("#status-label");

  startButton.addEventListener("click", function () {
    const value = document.getElementById("voice-id").value;
    console.log(value);
    fetch(`/start-conversation?voice=${value}`);
    startButton.style.display = "none";
    endButton.style.display = "block";
    setInterval(() => {
      if (!isConversing) {
        clearInterval(this);
      };
      console.log("fetching status");
      fetch("/conversation-status")
        .then(function (response) {
          return response.json();
        })
        .then((d) => {
          console.log(d.status);
          statusLabel.innerHTML = d.status;
        }).catch((e) => {
          clearInterval(this);
        });
    }, 2000);
  });

  endButton.addEventListener("click", function () {
    isConversing = false;
    fetch("/end-current-conversation");
    window.location.reload();
  });

  let voiceIdInput = document.querySelector("#voice-id");
  let headerImg = document.querySelector("#header-img");

  voiceIdInput.addEventListener("input", updateImageOnInputChange);

  function updateImageOnInputChange(e) {
    let newVoiceId = e.target.value;
    console.log(newVoiceId);
    headerImg.src = `/static/images/${newVoiceId}.jpeg`;
  }
</script>

</html>